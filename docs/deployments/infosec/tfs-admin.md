# TFS Admin

When you select `Settings` on your TFS on Sawtooth deployment you are presented
with this screen:

![Sextant Deployment TFS on Sawtooth Settings](../../images/sextant-deployments-tfs-sawtooth-settings.png){ .shadow}

There are five tabs each of which is described in detail below.

## TFS CLI

This tab provides you with the docker command you can use to spin up a TFS
client that lets you interact with your deployment using the TFS CLI.

![Sextant Deployment TFS on Sawtooth Settings TFS CLI](../../images/sextant-deployments-tfs-sawtooth-settings-tfs-cli.png){ .shadow}

!!!Warning
  Note that the docker command only works correctly if you connect to Sextant
  via a load balancer otherwise the TFS_URL is malformed.

## TFS Keys

This tab lets you create TFS keys for use when creating encrypted TFS volumes:

![Sextant Deployment TFS on Sawtooth Settings Add Key](../../images/sextant-deployments-tfs-sawtooth-settings-add-key.png){ .shadow}

!!!Important
  You need to save the key locally as this is generated by Sextant but not
  retained by it.

## TFS Volumes

This tab lets you create TFS volumes. Here we are creating `vol001` and
encrypting it using `key001`:

![Sextant Deployment TFS on Sawtooth Settings Add Vol](../../images/sextant-deployments-tfs-sawtooth-settings-add-vol.png){ .shadow}

Having encrypted this volume we will need the key we saved earlier to read from
or write to it but it is now listed:

![Sextant Deployment TFS on Sawtooth Settings Vol List](../../images/sextant-deployments-tfs-sawtooth-settings-vol-list.png){ .shadow}

This tab also lets us interact with the volumes. We can either `View Snapshots`,
`Create a Snapshot` or `Edit` each volume using the three icons.

Clicking `Edit` lets you change the name of a volume:

![Sextant Deployment TFS on Sawtooth Settings Edit Vol](../../images/sextant-deployments-tfs-sawtooth-settings-edit-vol.png){ .shadow}

Clicking `Create a Snapshot` switches the context to the `TFS Snapshots` pane
and let's you create a snapshot of your volume.

## TFS Snapshots

Here we are creating a second snapshot `snap002` for `vol001`:

![Sextant Deployment TFS on Sawtooth Settings Create Snapshot](../../images/sextant-deployments-tfs-sawtooth-settings-create-snapshot.png){ .shadow}

Which now appears in the snapshot list:

![Sextant Deployment TFS on Sawtooth Settings Snap List](../../images/sextant-deployments-tfs-sawtooth-settings-snap-list.png){ .shadow}

## TFS Explorer

Before taking a closer look at the explorer lets run a TFS CLI session using
our docker command to spin up a tfs-client container:

```bash
user@c03b78df5774:/$ tfs-cli volume list
  VOLUME NAME               VOLUME UUID                COMPRESSION   ENCRYPTION
  vol002        caa56fc3-2206-4d52-8c7e-81b600bab5bf   NONE          NONE
  vol001        102f91d4-aeaa-4e40-b60b-f036f2844790   LZ4           AES_GCM
user@c03b78df5774:/$ ls /mnt/tfs
user@c03b78df5774:/$ tfs-fuse -v vol002 -m /mnt/tfs
user@c03b78df5774:/$ cd /mnt/tfs
user@c03b78df5774:/mnt/tfs$ ls
user@c03b78df5774:/mnt/tfs$ echo "hello world" > hello-world.txt
user@c03b78df5774:/mnt/tfs$ cat hello-world.txt
hello world
user@c03b78df5774:/mnt/tfs$ ls
hello-world.txt
user@c03b78df5774:/mnt/tfs$
```

The explorer lets you drilldown on individual volumes such as `vol002` and as
you can see this lists the file `hello-world.txt` created in that session:

![Sextant Deployment TFS on Sawtooth Settings Explorer](../../images/sextant-deployments-tfs-sawtooth-settings-explorer.png){ .shadow}

At this point you can `Download`, `Open` or request `Info` on this file.
Opening it shows that the content mirrors the CLI session above:

![Sextant Deployment TFS on Sawtooth Settings Explorer Open](../../images/sextant-deployments-tfs-sawtooth-settings-explorer-open.png){ .shadow}

Requesting its information provides you with the following readout:

![Sextant Deployment TFS on Sawtooth Settings Explorer Info](../../images/sextant-deployments-tfs-sawtooth-settings-explorer-info.png){ .shadow}

Next we create (not shown) a snapshot `snap001` for `vol002` which is reflected
in the explorer:

![Sextant Deployment TFS on Sawtooth Settings Explorer Snap001](../../images/sextant-deployments-tfs-sawtooth-settings-explorer-snap001.png){ .shadow}

Next we return to our TFS CLI session where we can lst the snapshot then
create a second file `descartes.txt`:

```bash
user@c03b78df5774:/mnt/tfs$ tfs-cli volume snapshot list vol002
  SNAPSHOT NAME
  snap001
user@c03b78df5774:/mnt/tfs$ echo "I think therefore I am" > descartes.txt
user@c03b78df5774:/mnt/tfs$ cat descartes.txt
I think therefore I am
user@c03b78df5774:/mnt/tfs$
user@c03b78df5774:/mnt/tfs$ ls
descartes.txt  hello-world.txt
```

Returning to the explorer and looking at `latest` we can see the new file:

![Sextant Deployment TFS on Sawtooth Settings Explorer Latest](../../images/sextant-deployments-tfs-sawtooth-settings-explorer-latest.png){ .shadow}

!!!Note
  The snapshots are stored in a hidden readonly directory `.snapshots` as
  you can see if you switch back to the TFS CLI session:

```bash
user@c03b78df5774:/mnt/tfs$ ls -ltr
total 0
-rw-r--r-- 1 user user 12 Dec  7 21:44 hello-world.txt
-rw-r--r-- 1 user user 23 Dec  7 22:22 descartes.txt
user@c03b78df5774:/mnt/tfs$ ls -ltr .snapshots/
total 0
dr--r--r-- 1 root root 0 Dec  7 21:07 snap001
user@c03b78df5774:/mnt/tfs$ ls -ltr .snapshots/snap001/
total 0
-rw-r--r-- 1 user user 12 Dec  7 21:44 hello-world.txt
user@c03b78df5774:/mnt/tfs$
```

## Issues

__SXT-867__ TFS Explorer doesn't support encrypted volumes at present.
